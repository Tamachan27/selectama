<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SELECTAMA</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --main-grad: linear-gradient(135deg, #fbcfe8 0%, #e0e7ff 100%);
            --accent: #4338ca;
            --glass: rgba(255, 255, 255, 0.7);
            --text: #1f2937;
        }
        body {
            font-family: "Inter", "Hiragino Kaku Gothic ProN", sans-serif;
            background: var(--main-grad); background-attachment: fixed;
            margin: 0; padding: 0; color: var(--text); overflow-x: hidden;
        }
        .container { max-width: 550px; margin: 0 auto; padding: 40px 20px; }
        
        header { text-align: center; margin-bottom: 30px; }
        h1 { font-size: 3.2rem; letter-spacing: 8px; font-weight: 900; color: #4338ca; margin: 0; }
        .sub-desc { font-size: 0.75rem; color: #6366f1; letter-spacing: 4px; font-weight: 800; }

        .notice-text { text-align: center; font-size: 0.65rem; color: #6b7280; font-weight: normal; margin-bottom: 5px; }
        .guide-text { text-align: center; font-size: 0.95rem; font-weight: 900; margin-bottom: 20px; color: #4338ca; }

        .tag-guide {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;
            margin-bottom: 30px; background: rgba(255, 255, 255, 0.4);
            padding: 15px; border-radius: 20px; border: 1px solid white;
        }
        .tag-info {
            background: white; padding: 15px; border-radius: 15px;
            display: flex; flex-direction: column; border: 3px solid transparent;
            cursor: pointer; transition: 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.03);
        }
        .tag-info.active { border-color: var(--accent); background: #f5f7ff; }
        .tag-name { font-weight: 900; color: var(--accent); margin-bottom: 4px; font-size: 0.9rem; text-transform: uppercase; }
        .tag-desc { color: #6b7280; font-size: 0.65rem; line-height: 1.4; font-weight: 600; }

        #match-btn { 
            width: 100%; padding: 22px; border-radius: 20px; border: none; 
            background: #4338ca; color: white; font-weight: 900; font-size: 1.1rem; 
            cursor: pointer; display: none; box-shadow: 0 10px 25px rgba(67, 56, 202, 0.2);
        }

        #result-area { display: none; margin-top: 30px; }
        #capture-target { padding: 30px 15px; background: var(--main-grad); border-radius: 40px; }
        
        .best-match {
            background: rgba(255, 255, 255, 0.85); border-radius: 35px; padding: 40px 20px;
            text-align: center; border: 2px solid white; margin-bottom: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.08);
        }
        .best-label { font-size: 0.75rem; font-weight: 900; color: #4338ca; letter-spacing: 3px; margin-bottom: 10px; }
        .best-title { font-size: 1.8rem; font-weight: 900; margin: 10px 0; line-height: 1.2; }
        .best-artist { color: #6b7280; font-size: 1.1rem; font-weight: 600; margin-bottom: 25px; }
        
        .other-matches { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .other-card {
            background: rgba(255, 255, 255, 0.7); border-radius: 25px; padding: 20px 10px;
            text-align: center; border: 1px solid white;
        }
        .other-label { font-size: 0.6rem; font-weight: 800; color: #6366f1; margin-bottom: 5px; }
        .other-title { font-size: 0.9rem; font-weight: 900; margin: 5px 0; }
        .other-artist { font-size: 0.75rem; color: #6b7280; margin-bottom: 15px; }

        .yt-btn { 
            display: inline-block; background: #ff0000; color: white; 
            padding: 10px 20px; border-radius: 50px; text-decoration: none; 
            font-size: 0.75rem; font-weight: 900; cursor: pointer; border: none;
        }

        .action-btns { margin-top: 20px; display: flex; flex-direction: column; gap: 12px; }
        .btn-save { background: #10b981; color: white; padding: 20px; border-radius: 20px; border: none; font-weight: 800; cursor: pointer; }
        .btn-x { background: #000; color: white; padding: 20px; border-radius: 20px; border: none; font-weight: 800; cursor: pointer; }

        .footer-line {
            margin-top: 60px; display: flex; align-items: center; justify-content: center;
            gap: 15px; padding: 15px; background: rgba(255,255,255,0.3); border-radius: 40px; border: 1px solid white;
        }
        .creator-small { font-weight: 900; font-size: 0.75rem; color: #4338ca; white-space: nowrap; }
        .sns-mini-group { display: flex; gap: 8px; }
        .sns-mini { text-decoration: none; font-weight: 900; color: white; font-size: 0.65rem; padding: 10px 15px; border-radius: 50px; }

        @media (max-width: 480px) { .other-matches { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>SELECTAMA</h1>
        <p class="sub-desc">MUSIC DNA ANALYSIS</p>
    </header>

    <p class="notice-text">ã“ã®SELECTAMAã¯ãƒ†ã‚¹ãƒˆç‰ˆã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚ä¸å…·åˆãƒ»è¦æœ›ç­‰ã‚ã‚Šã¾ã—ãŸã‚‰ã€ã”é€£çµ¡ãã ã•ã„ã€‚</p>
    <p class="guide-text">å¥½ããªè¦ç´ ã‚’é¸ã‚“ã§ä¸‹ã•ã„</p>

    <div id="tag-guide-area" class="tag-guide">
        <div class="tag-info" data-tag="rock"><span class="tag-name">rock</span><span class="tag-desc">ç‹é“ã§ã‚«ãƒƒã‚³ã„ã„ãƒ­ãƒƒã‚¯</span></div>
        <div class="tag-info" data-tag="technical"><span class="tag-name">technical</span><span class="tag-desc">å¤‰æ‹å­ãªã©ã®ç²¾å·§ãªæŠ€è¡“ãƒ»æ§‹æˆ</span></div>
        <div class="tag-info" data-tag="Internets"><span class="tag-name">Internets</span><span class="tag-desc">ãƒãƒƒãƒˆç™ºã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ</span></div>
        <div class="tag-info" data-tag="loud"><span class="tag-name">loud</span><span class="tag-desc">ãƒœãƒ¼ã‚«ãƒ«ãƒ»ãƒãƒ³ãƒ‰å…±ã«ãƒ‘ãƒ¯ãƒ•ãƒ«</span></div>
        <div class="tag-info" data-tag="chill"><span class="tag-name">chill</span><span class="tag-desc">ãŠé…’ã§ã‚†ã‚‰ã‚†ã‚‰ã§ããã†</span></div>
        <div class="tag-info" data-tag="energy"><span class="tag-name">energy</span><span class="tag-desc">ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ãŒä¸ŠãŒã‚‹æ›²</span></div>
        <div class="tag-info" data-tag="dark"><span class="tag-name">dark</span><span class="tag-desc">é—‡ã‚’æ„Ÿã˜ã‚‹ãƒ»é‡ã„é›°å›²æ°—</span></div>
        <div class="tag-info" data-tag="positive"><span class="tag-name">positive</span><span class="tag-desc">æ˜ã‚‹ãã¦å‰å‘ããªæ›²</span></div>
        <div class="tag-info" data-tag="indies"><span class="tag-name">indies</span><span class="tag-desc">ã¾ã çŸ¥ã‚‰ã‚Œã¦ã„ãªã„ãƒãƒ³ãƒ‰</span></div>
        <div class="tag-info" data-tag="midnight"><span class="tag-name">midnight</span><span class="tag-desc">æ·±å¤œã«ä¸€äººã§æµ¸ã‚ŠãŸã„æ™‚</span></div>
        <div class="tag-info" data-tag="emotional"><span class="tag-name">emotional</span><span class="tag-desc">å¿ƒã«éŸ¿ããƒ»æ„Ÿå‹•ã™ã‚‹æ›²</span></div>
        <div class="tag-info" data-tag="inst"><span class="tag-name">inst</span><span class="tag-desc">æ­Œãªã—ãƒ»æ¥½å™¨ä¸»å½¹ã®æ›²</span></div>
        <div class="tag-info" data-tag="idol"><span class="tag-name">idol</span><span class="tag-desc">å¯æ„›ã•ã¨ã‚«ãƒƒã‚³ã‚ˆã•ã®å…±å­˜</span></div>
        <div class="tag-info" data-tag="dance"><span class="tag-name">dance</span><span class="tag-desc">ãƒ“ãƒ¼ãƒˆã®åŠ¹ã„ãŸæ›²</span></div>
    </div>

    <button id="match-btn" onclick="showMatch()">Start Matching</button>

    <div id="result-area">
        <div id="capture-target">
            <h2 style="text-align:center; font-size:0.7rem; letter-spacing:4px; color:#4338ca; margin-bottom:20px;">DNA ANALYSIS RESULT</h2>
            <div id="best-match-container"></div>
            <div id="other-matches-container" class="other-matches"></div>
        </div>
        <div class="action-btns">
            <button class="btn-save" onclick="saveAsImage()">çµæœã‚’ç”»åƒã§ä¿å­˜ã™ã‚‹</button>
            <button id="share-x-btn" class="btn-x">ğ•ã«æŠ•ç¨¿ã™ã‚‹</button>
            <button onclick="location.reload()" style="background:none; border:none; color:#6b7280; cursor:pointer; margin-top:10px; font-weight:bold;">é¸ã³ç›´ã™</button>
        </div>
    </div>

    <div class="footer-line">
        <div class="creator-small">Created by ãŸã¾</div>
        <div class="sns-mini-group">
            <a href="https://x.com/sunkorot" class="sns-mini" target="_blank" style="background:#000;">ğ•</a>
            <a href="https://open.spotify.com/user/73b31vzfia5bxj8llianbwveu?si=frw4_aYGQcGBNJs6b-ZsNg&nd=1&dlsi=9f154298a61449a27" class="sns-mini" target="_blank" style="background:#1DB954;">Spotify</a>
            <a href="https://on.soundcloud.com/iDHDBLdEl4fV2VCLzw" class="sns-mini" target="_blank" style="background:#ff5500;">SoundCloud</a>
        </div>
    </div>
</div>

<script>
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTArcbyBXRaH0XklEVYPzISsOv37VX352ZaYYPKu6ntDon8nOJDUT6Q8xob2wXUhJJW0LxpZsps5Evz/pub?output=csv';
    let selectedTags = new Set();
    let musicData = [];
    let bestSong = null;

    async function init() {
        try {
            const res = await fetch(CSV_URL);
            const csvText = await res.text();
            const rows = csvText.split(/\r?\n/).slice(1);
            musicData = rows.map(row => {
                const c = row.split(',').map(s => s.trim().replace(/^"|"$/g, ''));
                return { title: c[0], artist: c[1], tags: c[2], url: c[3] };
            }).filter(m => m.title);
            setupGuideClick();
        } catch (e) { console.error(e); }
    }

    function setupGuideClick() {
        document.querySelectorAll('.tag-info').forEach(info => {
            info.onclick = () => {
                const tag = info.getAttribute('data-tag');
                if (selectedTags.has(tag)) { selectedTags.delete(tag); info.classList.remove('active'); }
                else { selectedTags.add(tag); info.classList.add('active'); }
                document.getElementById('match-btn').style.display = selectedTags.size > 0 ? 'block' : 'none';
            };
        });
    }

    function getSearchUrl(artist, title) {
        return `https://www.youtube.com/results?search_query=${encodeURIComponent(artist + ' ' + title)}`;
    }

    function showMatch() {
        let results = musicData.map(song => {
            let matchCount = 0;
            selectedTags.forEach(t => { if (song.tags.includes(t)) matchCount++; });
            let score = matchCount / selectedTags.size;
            return { ...song, score };
        });

        results.sort((a, b) => b.score - a.score || Math.random() - 0.5);
        const topSongs = results.slice(0, 3).filter(r => r.score > 0);

        if (topSongs.length > 0) {
            bestSong = topSongs[0];
            document.getElementById('best-match-container').innerHTML = `
                <div class="best-match">
                    <div class="best-label">YOUR BEST MATCH</div>
                    <div class="best-title">${bestSong.title}</div>
                    <div class="best-artist">${bestSong.artist}</div>
                    <a href="${getSearchUrl(bestSong.artist, bestSong.title)}" target="_blank" class="yt-btn">YouTubeã§è´ã</a>
                </div>`;
            
            const others = topSongs.slice(1);
            const otherContainer = document.getElementById('other-matches-container');
            otherContainer.innerHTML = others.map(song => `
                <div class="other-card">
                    <div class="other-label">ALSO RECOMMENDED</div>
                    <div class="other-title">${song.title}</div>
                    <div class="other-artist">${song.artist}</div>
                    <a href="${getSearchUrl(song.artist, song.title)}" target="_blank" class="yt-btn" style="padding:6px 12px; font-size:0.6rem;">YouTube</a>
                </div>`).join('');
        }

        document.getElementById('tag-guide-area').style.display = 'none';
        document.querySelector('.guide-text').style.display = 'none';
        document.querySelector('.notice-text').style.display = 'none';
        document.getElementById('match-btn').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
        
        document.getElementById('share-x-btn').onclick = shareX;
        window.scrollTo(0,0);
    }

    async function saveAsImage() {
        const target = document.getElementById('capture-target');
        const canvas = await html2canvas(target, { scale: 2, useCORS: true });
        const link = document.createElement('a');
        link.download = 'SELECTAMA_Result.png';
        link.href = canvas.toDataURL();
        link.click();
    }

    function shareX() {
        if (!bestSong) return;
        const text = `ç§ã®ãƒ™ã‚¹ãƒˆãƒãƒƒãƒãªæ›²ã¯${bestSong.artist}ã®ã€Œ${bestSong.title}ã€ã§ã—ãŸï¼\n#SELECTAMA\n`;
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(window.location.href)}`, '_blank');
    }
    init();
</script>
</body>
</html>
