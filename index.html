<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SELECTAMA</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --main-grad: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%);
            --accent: #4338ca;
            --glass: rgba(255, 255, 255, 0.8);
            --text: #1f2937;
        }
        body {
            font-family: "Inter", "Hiragino Kaku Gothic ProN", sans-serif;
            background: var(--main-grad);
            background-attachment: fixed;
            margin: 0; padding: 0; color: var(--text);
        }
        .container { max-width: 600px; margin: 0 auto; padding: 60px 20px; }
        header { text-align: center; margin-bottom: 40px; }
        h1 { font-size: 3rem; letter-spacing: 6px; font-weight: 900; color: var(--accent); margin: 0; }
        .sub-desc { font-size: 0.8rem; color: var(--accent); letter-spacing: 2px; font-weight: 700; margin-top: 10px; }

        .guide-text { text-align: center; font-size: 0.9rem; font-weight: bold; margin-bottom: 20px; color: #4b5563; }

        .tag-selector { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 30px; }
        .tag-btn { 
            background: var(--glass); border: 1px solid #d1d5db; 
            color: #374151; padding: 10px 15px; border-radius: 8px; cursor: pointer; transition: 0.3s; font-size: 0.85rem; 
        }
        .tag-btn::before { content: "["; }
        .tag-btn::after { content: "]"; }
        .tag-btn.active { background: var(--accent); color: white; border-color: var(--accent); }

        #match-btn { 
            width: 100%; padding: 20px; border-radius: 15px; border: none; 
            background: var(--accent); color: white; font-weight: 900; font-size: 1.1rem; 
            cursor: pointer; display: none; box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        #result-area { display: none; margin-top: 40px; }
        #capture-target { padding: 30px 15px; background: var(--main-grad); border-radius: 20px; }
        .result-card { 
            background: rgba(255, 255, 255, 0.9); border-radius: 20px; padding: 30px 20px; 
            text-align: center; margin-bottom: 20px; border: 1px solid #e5e7eb;
        }
        .match-percent { font-size: 2.5rem; font-weight: 900; color: var(--accent); }
        .song-title { font-size: 1.4rem; font-weight: 900; margin: 10px 0; }
        .artist-name { color: #6b7280; font-size: 0.9rem; margin-bottom: 20px; }
        .yt-btn { display: inline-block; background: #ff0000; color: white; padding: 10px 25px; border-radius: 50px; text-decoration: none; font-size: 0.8rem; font-weight: bold; }

        .action-btns { margin-top: 20px; display: flex; flex-direction: column; gap: 10px; }
        .btn-save { background: #10b981; color: white; padding: 18px; border-radius: 15px; border: none; font-weight: 800; cursor: pointer; }
        .btn-x { background: #000; color: white; padding: 18px; border-radius: 15px; border: none; font-weight: 800; cursor: pointer; }

        .creator-section { margin-top: 60px; text-align: center; padding: 30px; border-top: 1px solid #d1d5db; }
        .creator-name { font-weight: 900; font-size: 1.2rem; color: var(--accent); margin-bottom: 15px; }
        .sns-links { display: flex; justify-content: center; gap: 20px; }
        .sns-link { text-decoration: none; font-weight: bold; color: var(--accent); font-size: 0.85rem; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>SELECTAMA</h1>
        <p class="sub-desc">MUSIC DNA ANALYSIS</p>
    </header>

    <p class="guide-text">Â•Ω„Åç„Å™Ë¶ÅÁ¥†„Çí„Åô„Åπ„Å¶ÈÅ∏„Çì„Åß‰∏ã„Åï„ÅÑÔºàË§áÊï∞ÈÅ∏ÊäûOKÔºâ</p>
    <div id="tag-container" class="tag-selector"></div>
    <button id="match-btn" onclick="showMatch()">Start Matching</button>

    <div id="result-area">
        <div id="capture-target">
            <h2 style="text-align:center; font-size:0.9rem; color:var(--accent); letter-spacing:2px; margin-bottom:20px;">SELECTED FOR YOU</h2>
            <div id="cards-container"></div>
        </div>
        
        <div class="action-btns">
            <button class="btn-save" onclick="saveAsImage()">ÁµêÊûú„ÇíÁîªÂÉè„Åß‰øùÂ≠ò„Åô„Çã</button>
            <button class="btn-x" onclick="shareX()">ùïè„Å´ÊäïÁ®ø„Åô„Çã</button>
            <button onclick="location.reload()" style="background:none; border:none; color:#6b7280; cursor:pointer; margin-top:10px;">ÈÅ∏„Å≥Áõ¥„Åô</button>
        </div>
    </div>

    <div class="creator-section">
        <div class="creator-name">Curated by „Åü„Åæ</div>
        <div class="sns-links">
            <a href="https://open.spotify.com/user/sunkoro_t" class="sns-link" target="_blank">Spotify</a>
            <a href="https://x.com/sunkorot" class="sns-link" target="_blank">ùïè (Twitter)</a>
            <a href="https://on.soundcloud.com/iDHDBLdEl4fV2VCLzw" class="sns-link" target="_blank">SoundCloud</a>
        </div>
    </div>
</div>

<script>
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTArcbyBXRaH0XklEVYPzISsOv37VX352ZaYYPKu6ntDon8nOJDUT6Q8xob2wXUhJJW0LxpZsps5Evz/pub?output=csv';
    // Êñ∞„Åó„ÅÑ„Çø„Ç∞„É™„Çπ„ÉàÔºàmale/female„ÇíÂâäÈô§„Åó„ÄÅmidnight/emotional„ÇíËøΩÂä†Ôºâ
    const displayTags = ["rock", "technical", "Internets", "loud", "chill", "energy", "dark", "possitive", "indies", "midnight", "emotional", "inst"];
    let selectedTags = new Set();
    let musicData = [];

    async function init() {
        try {
            const res = await fetch(CSV_URL);
            const csvText = await res.text();
            const rows = csvText.split(/\r?\n/).slice(1);
            musicData = rows.map(row => {
                const c = row.split(',').map(s => s.trim().replace(/^"|"$/g, ''));
                return { title: c[0], artist: c[1], tags: c[2], url: c[3] };
            }).filter(m => m.title);
            renderTags();
        } catch (e) { console.error(e); }
    }

    function renderTags() {
        const container = document.getElementById('tag-container');
        displayTags.forEach(tag => {
            const btn = document.createElement('button');
            btn.className = 'tag-btn';
            btn.innerText = tag;
            btn.onclick = () => {
                if (selectedTags.has(tag)) { selectedTags.delete(tag); btn.classList.remove('active'); }
                else { selectedTags.add(tag); btn.classList.add('active'); }
                document.getElementById('match-btn').style.display = selectedTags.size > 0 ? 'block' : 'none';
            };
            container.appendChild(btn);
        });
    }

    function showMatch() {
        let results = musicData.map(song => {
            let matchCount = 0;
            selectedTags.forEach(t => { if (song.tags.includes(t)) matchCount++; });
            let percent = Math.round((matchCount / selectedTags.size) * 100);
            return { ...song, percent };
        });

        results.sort((a, b) => b.percent - a.percent || Math.random() - 0.5);
        const bestThree = results.slice(0, 3).filter(r => r.percent > 0);

        const container = document.getElementById('cards-container');
        container.innerHTML = '';
        bestThree.forEach(song => {
            container.innerHTML += `
                <div class="result-card">
                    <div class="match-percent">${song.percent}%</div>
                    <div class="song-title">${song.title}</div>
                    <div class="artist-name">${song.artist}</div>
                    <a href="${song.url}" target="_blank" class="yt-btn">YouTube„ÅßËÅ¥„Åè</a>
                </div>
            `;
        });

        document.querySelector('.guide-text').style.display = 'none';
        document.getElementById('tag-container').style.display = 'none';
        document.getElementById('match-btn').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
        window.scrollTo(0,0);
    }

    async function saveAsImage() {
        const target = document.getElementById('capture-target');
        const canvas = await html2canvas(target, { scale: 2 });
        const link = document.createElement('a');
        link.download = 'SELECTAMA.png';
        link.href = canvas.toDataURL();
        link.click();
    }

    function shareX() {
        const text = `SELECTAMAÔºö„Åü„Åæ(@sunkorot)„ÅåÈÅ∏„Å∂ÁßÅ„Å∏„ÅÆ‰∏ÄÊõ≤„ÅØ„Åì„Çå„Åß„Åó„ÅüÔºÅ\n`;
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(window.location.href)}`, '_blank');
    }
    init();
</script>
</body>
</html>
</script>
</body>
</html>
