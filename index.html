<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SELECTAMA</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --main-grad: linear-gradient(135deg, #fbcfe8 0%, #e0e7ff 100%);
            --accent: #4338ca;
            --glass: rgba(255, 255, 255, 0.6);
            --text: #1f2937;
        }
        body {
            font-family: "Inter", "Hiragino Kaku Gothic ProN", sans-serif;
            background: var(--main-grad); background-attachment: fixed;
            margin: 0; padding: 0; color: var(--text); overflow-x: hidden;
        }
        .container { max-width: 550px; margin: 0 auto; padding: 40px 20px; }
        
        header { text-align: center; margin-bottom: 30px; }
        h1 { font-size: 3.2rem; letter-spacing: 8px; font-weight: 900; color: #4338ca; margin: 0; }
        .sub-desc { font-size: 0.75rem; color: #6366f1; letter-spacing: 4px; font-weight: 800; }

        .guide-text { text-align: center; font-size: 0.95rem; font-weight: 900; margin-bottom: 20px; color: #4338ca; }

        /* èª¬æ˜ã‚¨ãƒªã‚¢ã‚’ãã®ã¾ã¾é¸æŠãƒœã‚¿ãƒ³ã« */
        .tag-guide {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;
            margin-bottom: 30px; background: rgba(255, 255, 255, 0.4);
            padding: 15px; border-radius: 20px; border: 1px solid white;
        }
        .tag-info {
            background: white; padding: 15px; border-radius: 15px;
            display: flex; flex-direction: column; border: 3px solid transparent;
            cursor: pointer; transition: 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.03);
            text-align: left;
        }
        .tag-info:hover { transform: translateY(-2px); border-color: #e0e7ff; }
        .tag-info.active { border-color: var(--accent); background: #f5f7ff; }
        .tag-name { font-weight: 900; color: var(--accent); margin-bottom: 4px; font-size: 0.9rem; text-transform: uppercase; }
        .tag-desc { color: #6b7280; font-size: 0.65rem; line-height: 1.4; font-weight: 600; }

        #match-btn { 
            width: 100%; padding: 22px; border-radius: 20px; border: none; 
            background: #4338ca; color: white; font-weight: 900; font-size: 1.1rem; 
            cursor: pointer; display: none; box-shadow: 0 10px 25px rgba(67, 56, 202, 0.2);
        }

        /* çµæœã‚¨ãƒªã‚¢ */
        #result-area { display: none; margin-top: 40px; }
        #capture-target { padding: 35px 15px; background: var(--main-grad); border-radius: 40px; }
        .result-card { 
            background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(15px);
            border-radius: 35px; padding: 40px 25px; border: 1px solid white; 
            text-align: center; margin-bottom: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.08);
        }
        .match-percent { font-size: 3.5rem; font-weight: 900; color: #4338ca; font-style: italic; }
        .song-title { font-size: 1.6rem; font-weight: 900; margin: 15px 0 5px; line-height: 1.2; }
        .artist-name { color: #6b7280; font-size: 1.1rem; margin-bottom: 25px; font-weight: 600; }
        .yt-btn { display: inline-block; background: #ff0000; color: white; padding: 12px 30px; border-radius: 50px; text-decoration: none; font-size: 0.85rem; font-weight: 900; }

        .action-btns { margin-top: 20px; display: flex; flex-direction: column; gap: 12px; }
        .btn-save { background: #10b981; color: white; padding: 20px; border-radius: 20px; border: none; font-weight: 800; cursor: pointer; }
        .btn-x { background: #000; color: white; padding: 20px; border-radius: 20px; border: none; font-weight: 800; cursor: pointer; }

        /* SNSã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .creator-section { margin-top: 100px; text-align: center; border-top: 1px solid rgba(0,0,0,0.05); padding-top: 50px; }
        .creator-name { font-weight: 900; font-size: 1.2rem; color: #4338ca; margin-bottom: 25px; }
        .sns-container { 
            display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; 
            background: rgba(255,255,255,0.4); padding: 20px; border-radius: 30px; border: 1px solid white;
        }
        .sns-link { text-decoration: none; font-weight: 800; color: white; font-size: 0.75rem; padding: 12px 20px; border-radius: 50px; transition: 0.2s; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>SELECTAMA</h1>
        <p class="sub-desc">MUSIC DNA ANALYSIS</p>
    </header>

    <p class="guide-text">å¥½ããªè¦ç´ ã‚’é¸ã‚“ã§ä¸‹ã•ã„ï¼ˆè¤‡æ•°é¸æŠOKï¼‰</p>

    <div id="tag-guide-area" class="tag-guide">
        <div class="tag-info" data-tag="rock"><span class="tag-name">rock</span><span class="tag-desc">ç‹é“ã§ã‚«ãƒƒã‚³ã„ã„ãƒ­ãƒƒã‚¯</span></div>
        <div class="tag-info" data-tag="technical"><span class="tag-name">technical</span><span class="tag-desc">å¤‰æ‹å­ãªã©ã®ç²¾å·§ãªæŠ€è¡“ãƒ»æ§‹æˆ</span></div>
        <div class="tag-info" data-tag="Internets"><span class="tag-name">Internets</span><span class="tag-desc">ãƒãƒƒãƒˆç™ºã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ</span></div>
        <div class="tag-info" data-tag="loud"><span class="tag-name">loud</span><span class="tag-desc">ãƒœãƒ¼ã‚«ãƒ«ãƒ»ãƒãƒ³ãƒ‰å…±ã«ãƒ‘ãƒ¯ãƒ•ãƒ«ï¼ˆã†ã‚‹ã•ã„ï¼‰</span></div>
        <div class="tag-info" data-tag="chill"><span class="tag-name">chill</span><span class="tag-desc">ã‚†ã£ãŸã‚Šãƒªãƒ©ãƒƒã‚¯ã‚¹ã€ãŠé…’ã§ã‚†ã‚‰ã‚†ã‚‰ã§ããã†</span></div>
        <div class="tag-info" data-tag="energy"><span class="tag-name">energy</span><span class="tag-desc">ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ãŒä¸ŠãŒã‚‹æ›²</span></div>
        <div class="tag-info" data-tag="dark"><span class="tag-name">dark</span><span class="tag-desc">é—‡ã‚’æ„Ÿã˜ã‚‹ãƒ»é‡ã„é›°å›²æ°—</span></div>
        <div class="tag-info" data-tag="positive"><span class="tag-name">positive</span><span class="tag-desc">æ˜ã‚‹ãã¦å‰å‘ããªæ›²</span></div>
        <div class="tag-info" data-tag="indies"><span class="tag-name">indies</span><span class="tag-desc">ã¾ã çŸ¥ã‚‰ã‚Œã¦ã„ãªã„ãƒãƒ³ãƒ‰</span></div>
        <div class="tag-info" data-tag="midnight"><span class="tag-name">midnight</span><span class="tag-desc">æ·±å¤œã«ä¸€äººã§æµ¸ã‚ŠãŸã„æ™‚</span></div>
        <div class="tag-info" data-tag="emotional"><span class="tag-name">emotional</span><span class="tag-desc">å¿ƒã«éŸ¿ããƒ»æ„Ÿå‹•ã™ã‚‹æ›²</span></div>
        <div class="tag-info" data-tag="inst"><span class="tag-name">inst</span><span class="tag-desc">æ­Œãªã—ãƒ»æ¥½å™¨ä¸»å½¹ã®æ›²</span></div>
        <div class="tag-info" data-tag="idol"><span class="tag-name">idol</span><span class="tag-desc">å¯æ„›ã•ã¨ã‚«ãƒƒã‚³ã‚ˆã•ãŒå…±å­˜ã™ã‚‹æ¥½æ›²</span></div>
        <div class="tag-info" data-tag="dance"><span class="tag-name">dance</span><span class="tag-desc">å‹æ‰‹ã«ä½“ãŒå‹•ã„ã¡ã‚ƒã†ã€ãƒ“ãƒ¼ãƒˆã®åŠ¹ã„ãŸæ›²</span></div>
    </div>

    <button id="match-btn" onclick="showMatch()">Start Matching</button>

    <div id="result-area">
        <div id="capture-target">
            <h2 style="text-align:center; font-size:0.8rem; letter-spacing:4px; color:#4338ca; margin-bottom:20px;">SELECTED FOR YOU</h2>
            <div id="cards-container"></div>
        </div>
        <div class="action-btns">
            <button class="btn-save" onclick="saveAsImage()">çµæœã‚’ç”»åƒã§ä¿å­˜ã™ã‚‹</button>
            <button class="btn-x" onclick="shareX()">ğ•ã«æŠ•ç¨¿ã™ã‚‹</button>
            <button onclick="location.reload()" style="background:none; border:none; color:#6b7280; cursor:pointer; margin-top:10px; font-weight:bold;">é¸ã³ç›´ã™</button>
        </div>
    </div>

    <div class="creator-section">
        <div class="creator-name">Created by ãŸã¾</div>
        <div class="sns-container">
            <a href="https://x.com/sunkorot" class="sns-link" target="_blank" style="background:#000;">ğ• (Twitter)</a>
            <a href="https://open.spotify.com/user/73b31vzfia5bxj8llianbwveu?si=frw4_aYGQcGBNJs6b-ZsNg6" class="sns-link" style="background:#1DB954;">Spotify</a>
            <a href="https://on.soundcloud.com/iDHDBLdEl4fV2VCLzw" class="sns-link" target="_blank" style="background:#ff5500;">SoundCloud</a>
        </div>
    </div>
</div>

<script>
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTArcbyBXRaH0XklEVYPzISsOv37VX352ZaYYPKu6ntDon8nOJDUT6Q8xob2wXUhJJW0LxpZsps5Evz/pub?output=csv';
    let selectedTags = new Set();
    let musicData = [];

    async function init() {
        try {
            const res = await fetch(CSV_URL);
            const csvText = await res.text();
            const rows = csvText.split(/\r?\n/).slice(1);
            musicData = rows.map(row => {
                const c = row.split(',').map(s => s.trim().replace(/^"|"$/g, ''));
                return { title: c[0], artist: c[1], tags: c[2], url: c[3] };
            }).filter(m => m.title);
            setupGuideClick();
        } catch (e) { console.error(e); }
    }

    function setupGuideClick() {
        document.querySelectorAll('.tag-info').forEach(info => {
            info.onclick = () => {
                const tag = info.getAttribute('data-tag');
                if (selectedTags.has(tag)) {
                    selectedTags.delete(tag);
                    info.classList.remove('active');
                } else {
                    selectedTags.add(tag);
                    info.classList.add('active');
                }
                document.getElementById('match-btn').style.display = selectedTags.size > 0 ? 'block' : 'none';
            };
        });
    }

    function showMatch() {
        let results = musicData.map(song => {
            let matchCount = 0;
            selectedTags.forEach(t => { if (song.tags.includes(t)) matchCount++; });
            let percent = Math.round((matchCount / selectedTags.size) * 100);
            return { ...song, percent };
        });
        results.sort((a, b) => b.percent - a.percent || Math.random() - 0.5);
        const bestThree = results.slice(0, 3).filter(r => r.percent > 0);
        const container = document.getElementById('cards-container');
        container.innerHTML = '';
        bestThree.forEach(song => {
            container.innerHTML += `<div class="result-card"><div class="match-percent">${song.percent}%</div><div class="song-title">${song.title}</div><div class="artist-name">${song.artist}</div><a href="${song.url}" target="_blank" class="yt-btn">YouTubeã§è´ã</a></div>`;
        });
        document.getElementById('tag-guide-area').style.display = 'none';
        document.querySelector('.guide-text').style.display = 'none';
        document.getElementById('match-btn').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
        window.scrollTo(0,0);
    }

    async function saveAsImage() {
        const target = document.getElementById('capture-target');
        const canvas = await html2canvas(target, { scale: 2, useCORS: true });
        const link = document.createElement('a');
        link.download = 'SELECTAMA.png';
        link.href = canvas.toDataURL();
        link.click();
    }

    function shareX() {
        const text = `SELECTAMAï¼šãŸã¾(@sunkorot)ãŒé¸ã¶ã€ç§ã¸ã®ãƒ™ã‚¹ãƒˆãƒãƒƒãƒãªæ›²ã¯ã“ã‚Œï¼\n#SELECTAMA\n`;
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(window.location.href)}`, '_blank');
    }
    init();
</script>
</body>
</html>
